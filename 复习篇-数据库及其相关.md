# 数据库相关复习汇总

## Part1：MySQL必知必会

- SQL(Structured  Query  Language)，SQL是专门用来与数据库通信的语言。

```shell
#  SQL语句分类：
	DQL(数据查询语言)：查询语句，凡是select语句都是DQL
	DML(数据操作语言)：insert, delete, update，对表当中的数据进行增删改
	DDL(数据定义语言)：create, drop, alter，对表结构的增删改
	TCL(事务控制语言)：commit 提交事务，rollback 回滚事务
	DCL(数据控制语言)：grant 授权，revoke撤销权限等
```



```shell
# DISTINCT 关键字
	指示MySQL只返回不同的值。注意：DISTINCT 关键字只能使用在 SELECT 语句中，并且 DISTINCT 关键字应用于所有列而不仅是前置它的列。
	SELECT DISTINCT vend_id,prod_price,除非指定的两个列都相同，否则所有行都将被检索出来。
	参考博客：https://www.cnblogs.com/lbxBlog/p/9383174.html
```



```shell
# LIMIT 关键字
	为了在 SELECT 结果中返回第一行或前几行，可使用 LIMIT 子句。
	带一个值的 LIMIT 总是从第一行开始，给出的数为返回的行数，LIMIT 5，返回从第1行开始的5行
	带两个值的 LIMIT 可以指定从行号为第一个值的位置开始，LIMIT 5,5，返回从第5行开始的5行，
	行0：检索出来的第一行为行0，因此LIMIT 1,1返回第2行；
```



```shell
# ORDER BY 关键字
	ORDER BY 子句取一个或多个列的名字，据此对输出进行排序。
	排序方向：默认升序：ASC，降序排序：DESC
	多个列按不同顺序排序：
	SELECT prod_id,prod_price,prod_name
	FROM products
	ORDER BY prod_price DESC,prod_name; 按照prod_price降序，prod_name升序排序所选序列
# SQL 关键字顺序： SELECT -> FROM -> ORDER BY -> LIMIT
```



```shell
# WHERE 关键字
	WHERE 子句操作符：=(等于)  <>(不等于)  !=(不等于)  <(小于)  <=(小于等于)  >(大于)  >=(大于等于)  BETWEEN a AND b(在闭区间[a, b])
    IS NULL:检查具有NULL值的列，WHERE prod_price IS NULL;
    AND：用在 WHERE 子句中的关键字，用来指示检索满足所有给定条件的行；
    OR：用在 WHERE 子句中的关键处，用来表示检索匹配任一给定条件的行；
    IN： WHERE 子句中用来指定要匹配值的清单的关键字 WHERE vend_id (NOT) IN (1002, 1003);
# SQL 关键字顺序： SELECT -> FROM -> WHERE -> ORDER BY -> LIMIT
```



```shell
# 通配符 %  _
# LIKE 关键字：为在搜索子句中使用通配符，必须使用 LIKE 操作符。LIKE 指示 MySQL，后跟的搜索模式利用通配符匹配而不是直接相等匹配进行比较。
# %：在搜索串中，% 表示任何字符出现任意次数。
# _：在搜索串中，_ 总是匹配一个字符，不能多也不能少。
# MySQL中，'\' 具有转义作用，'\_' 表示普通的下划线，例如匹配名字中有下划线： LIKE '%\_%'；
```



```shell
# 正则表达式
	正则表达式的作用是匹配文本，将一个模式(正则表达式)与一个文本串进行比较。
	REGEXP 关键字：REGEXP 后所跟的东西为正则表达式；
	WHERE prod_name REGEXP '1000|2000'('\\[0-9] sticks?\\')
```

 

```shell
# 计算字段
	计算字段是运行在 SELECT 语句内创建的。
	# 拼接(concatenate)：将值联结到一起构成单个值；
		在 MySQL 的 SELECT 语句中，可使用 Concat() 函数来拼接两个列。
		Concat()拼接串，把多个串拼接起来形成一个较长的串： SELECT Concat(vend_name,' (',vend_country,')')
	# Trim() 函数
		RTrim()：去掉串右边的空格
		LTrim()：去掉串左边的空格
		Trim()：去掉串左右两边的空格
	# 使用别名
		 SELECT ... AS alias
```



```shell
# 使用数据处理函数
 # 文本处理函数
 	Upper()：转换为大写
 	Lower()：转换为小写
 	RTrim()：去掉串右边的空格
	LTrim()：去掉串左边的空格
	Trim()：去掉串左右两边的空格
	举例：SELECT vend_name, Upper(vend_name) AS vend_name_upcase
 # 日期处理函数
 	AddDate()：增加一个日期(天、周等)
 	AddTime()：增加一个时间(时、分等)
 	CurDate()：返回当前日期
 	CurTime()：返回当前时间
 	Date()：返回日期时间的日期部分
 	DateDiff()：计算两个日期之差
 	Date_Add()：高度灵活的日期运算函数
 	Date_Format()：返回一个格式化的日期或时间串
 	Day()：返回一个日期的天数部分
 	DayOfWeek()：对于一个日期，返回星期几
 	Hour()：返回一个日期的小时部分
 	Minute()：返回一个日期的分钟部分
 	Month()：返回一个日期的月份部分
 	Now()：返回当前日期和时间
 	Second()：返回一个时间的秒部分
 	Time()：返回一个日期时间的时间部分
 	Year()：返回一个日期的年份部分
 	SELECT cust_id, order_num
	FROM orders
	WHERE Date(order_date) = '2005-09-01';
```



```shell
# 汇总数据、聚集函数
 聚集函数(Aggregate Function)：运行在行组上，计算和返回单个值的函数。
 # AVG() 函数
 	AVG() 通过对表中行数计数并计算特定列值之和，求得该列的平均值。AVG() 可用来返回所有列的平均值，也可以用来返回特定列或行的平均值。
 	AVG() 函数忽略列值为NULL的行。
 	SELECT AVG(prod_price) AS avg_price
	FROM products
	WHERE vend_id = 1003;
 # COUNT() 函数
 	COUNT() 函数进行计数，可利用COUNT() 确定表中行的数目或符合特定条件的行的数目。
 	COUNT() 函数有两种使用方式：
 		使用COUNT(*) 对表中行的数目进行计数，不管表列中包含的是空值(NULL)还是非空值。
 		使用COUNT(column) 对特定列中具有的值进行计数，忽略NULL值。
 # MAX() 函数
 	MAX() 函数返回指定列中的最大值。MAX() 要求指定列名。
 	MAX() 函数忽略列值为NULL的行。
 # MIN() 函数
 	MIN() 函数返回指定列中的最小值。MIN() 要求指定列名。
 	MIN() 函数忽略列值为NULL的行。
 # SUM() 函数
 	SUM() 用来返回指定列值的和。SUM() 也可以用来合计计算值。
 	SUM() 函数忽略行值为NUNLL的行。
 	SELECT SUM(item_price*quantity) AS total_price
	FROM orderitems
	WHERE order_num = 20005;
 # 聚集不同值
 	以上五个聚集函数都可以如下使用：
 		对所有的行执行计算，指定ALL参数或者不给参数(因为ALL是默认行为)；
 		只包含不同的值，指定 DISTINCT 参数；
 	SELECT AVG(DISTINCT prod_price) AS avg_price
	FROM products
	WHERE vend_id = 1003;
```



```shell
# 分组数据
	# 创建分组
		分组是在SELECT语句的GROUP BY子句中建立的。
		GROUP BY 子句指示MySQL分组数据，然后对每个分组而不是整个结果集进行聚集。
		SELECT COUNT(prod_id) AS num_prods
		FROM products
		GROUP BY vend_id;
	# 过滤分组
		HAVING 过滤分组，WHERE 过滤行；
		HAVING 和 WHERE的区别：
			WHERE在数据分组前进行过滤，HAVING在数据分组后进行过滤。WHERE 排除的行不包括在分组中。
		SELECT cust_id, COUNT(*) AS orders
		FROM orders
		GROUP BY cust_id
		HAVING COUNT(*) >= 2;
```



```shell
# SELECT 子句顺序
	SELECT			要返回的列或表达式	
	FROM			从中检索数据的表	
	WHERE			行级过滤			
	GROUP BY		分组说明		
	HAVING			组级过滤
	ORDER BY		输出排序序列
	LIMIT			要检索的行数
```



```shell
# 使用子查询
	举例：列出订购物品TNT2的所有客户
		第一步：查询订购物品TNT2物品的订单
			SELECT order_num
            FROM orderitems
			WHERE prod_id = 'TNT2';
		第二步：查询第一步订单对应的客户ID
			SELECT cust_id
			FROM orders
			WHERE order_num IN (20005,20007);
		第三步：返回第二步查询的顾客ID对应的信息
			SELECT cust_name, cust_contact
			FROM customers
			WHERE cust_id IN (10001,10004);
		使用子查询：
			SELECT cust_name, cust_contact
			FROM customers
			WHERE cust_id IN (
				SELECT cust_id
				FROM orders
				WHERE order_num IN (
					SELECT order_num
            		FROM orderitems
					WHERE prod_id = 'TNT2'
				)
			);
	举例：显示customers表中每个客户的订单总数
		第一步：客户订单总数
			SELECT COUNT(*)
			FROM orders
			WHERE orders.cust_id = 10001;
		第二步：查询所有客户订单
			SELECT cust_name,
	   			   cust_state,
	   				(SELECT COUNT(*)
					FROM orders
					WHERE orders.cust_id = customers.cust_id) AS orders
			FROM customers
			ORDER BY cust_name;
```



```shell
# 联结表
	外键(foreign key)：外键为某个表中的一列，它包含另一个表的主键值，定义了两个表之间的关系。
	在联结两个表时，实际上是将第一个表中的每一行与第二个表中的每一行配对。WHERE子句作为过滤条件，它只包含那些匹配给定条件(联结条件)的行。没有WHERE子句，第一个表中的每个行将与第二个表中的每个行配对，而不管它们逻辑上是否可以配在一起。
 # 笛卡尔积(cartesian product)：由没有联结条件的表关系返回的结果为笛卡尔积。检索出的行的数目将是第一个表    中的行数乘以第二个表中的行数。
 # 联结：
 	内部联结(可以联结多个表)：等值联结、非等值联结、自联结
 		举例：列出订购物品TNT2的所有客户
 		SELECT cust_name, cust_state
		FROM customers, orders, orderitems
		WHERE customers.cust_id = orders.cust_id
			AND orders.order_num = orderitems.order_num
			AND orderitems.prod_id = 'TNT2';
	外部联结：LEFT OUTER JOIN 选择左边表中的所有行
		SELECT customers.cust_id, orders.order_num
		FROM customers LEFT OUTER JOIN orders
		ON customers.cust_id = orders.cust_id;
```



```shell
# 组合查询
	MySQL允许执行多个查询(多个SELECT语句)，并将结果作为单个查询结果返回，这些组合查询通常称为并(union)或复合查询(compound query);
	有两种基本情况，其中需要使用组合查询：
		在单个查询中从不同的表返回类似结构的数据；
		对单个表执行多个查询，按单个查询返回数据；
#   UNION规则：
	UNION中的每个查询必须包含相同的列、表达式或聚集函数；
	列数据类型必须兼容：类型不必完全相同，但必须是DBMS可以隐含地转换的类型。
	UNION默认取消重复的行，若想匹配返回所有的行，可使用 UNION ALL 而不是 UNION；
	UNION只允许在最后一个SELECT语句中使用ORDER BY，排序所有SELECT语句返回的结果；
```



```shell
# 全文本搜索
	MyISM引擎支持全文本搜索；InnoDB引擎不支持全文本搜索。
	在创建表时(create table)指定FULLTEXT，MySQL自动维护该索引，在增加、更新或删除行时，索引随之自动更新。
	在索引之后，使用两个函数Match() 和 Against() 执行全文本搜索，其中 Match() 指定被搜索的列，Against() 指定要使用的搜索表达式。
	全文本搜索结果按等级值排序，等级由MySQL根据行中词的数目、唯一词的数目、整个索引中词的总数以及包含该词的行的数目计算出来。全文本搜索排除等级为0的行，搜索结果按等级以降序排序。
```



```shell
# 增删改
	插入数据：INSERT INTO 表名(字段名) VALUES (数据1),(数据2);
	删除数据：DELETE FROM 表名 WHERE 条件；
	修改数据：UPDATE 表名 SET a = b, c = d WHERE 条件；
```



```shell
# 使用存储过程
	存储过程简单来说：就是为以后的使用而保存的一条或多条MySQL语句的集合。
	创建存储过程：
		delimiter $$    # 将语句的结束符号从分号;临时改为两个$$(可以是自定义)
		CREATE PROCEDURE productpricing()
		BEGIN
			SELECT Avg(prod_price) AS priceaverage
			FROM products;
		END $$
		delimiter ;		# 将语句的结束符号恢复为分号
	调用存储过程：
		CALL productpricing();
	删除调用过程：
		DROP PROCEDURE productpricing;
	检查存储过程：
		SHOW CREATE PROCEDURE productpricing;
 # 变量：内存中一个特定的位置，用来临时处理数据，所有MySQL变量都必须以@开始；
 	MySQL支持IN(传递给存储过程)、OUT(从存储过程中传出)、INOUT(对存储过程传入传出)类型的参数。
```



```shell
# 管理事务处理
	InnoDB支持明确的事务处理管理，MyISAM不支持事务处理。
	事务处理(Transaction Processing)可以用来维护数据库的完整性，它保证成批的MySQL操作要么完全执行，要么完全不执行。
	事务处理是一种机制，用来管理必须成批执行的MySQL操作，以保证数据库不包含不完整的操作结果。利用事务处理，可以保证一组操作不会中途停止，它们或者作为整体执行，或者完全不执行。如果没有错误发生，整组语句提交(写到)数据库表。如果发生错误，则进行回退以恢复数据库到某个已知且安全的状态。
	事务处理的术语：
		事务(transaction)指一组SQL语句；
		回退(rollback)指撤销指定SQL语句的过程；
		提交(commit)指将未存储的SQL语句结果写入数据库表；
		保留点(savepoint)指事务处理中设置的临时占位符，可以回退部分事务。保留点在事务处理完成(执行一条ROLLBACK或COMMIT)后自动释放。
```



## Part2：MySQL技术内幕--InnoDB存储引擎























